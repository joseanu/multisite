{%- assign canonical_url = page.url | replace:'index.html','' | prepend: site.url -%}
{%- assign cantTipoProducto = 0 -%}
{%- for tipo in site.data.productos[page.slug] -%}
  {%- if tipo[0] != 'contenidos' -%}
    {%- assign cantTipoProducto = cantTipoProducto | plus: 1 -%}
  {%- endif -%}
{%- endfor -%}
{%- if cantTipoProducto > 0 -%}
  {%- assign ImagePath = '/assets/img/productos/' -%}
  {%- capture jsonld -%}"mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
  {%- for tipo in site.data.productos[page.slug] -%}
    {%- assign tipoSlug = tipo[0] -%}
    {%- assign nombreTipo = page.tipos[tipoSlug].producto -%}
    {%- if cantTipoProducto > 1 -%}
      {%- assign imageList = site.data.imageList[page.slug][tipoSlug] -%}
    {%- else -%}
      {%- assign imageList = site.data.imageList[page.slug] -%}
    {%- endif -%}
    {%- for producto in tipo[1] -%}
      {%- assign itemString = '' -%}
      {%- for imagen in imageList -%}
        {%- if imagen[0] contains producto.modelo -%}
          {%- capture itemString -%}{{ itemString }}{{ imagen[1] | remove: '.jpg' }}|||{%- endcapture -%}
        {%- endif -%}
      {%- endfor -%}
      {%- assign imagenes = itemString | split: '|||' -%}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "item": {
          "@type": "Product",
          "@id": "{{ canonical_url }}#{{ producto.modelo }}",
          "name": "{% if nombreTipo %}{{ nombreTipo }} {% endif %}{{ producto.marca }} {{ producto.modelo }}",
          "model": "{{ producto.modelo }}",
          "description": {{ producto.caracteristicas | jsonify }},
          {%- if imagenes[0] -%}"image": "{{ site.url }}{{ ImagePath }}{{ imagenes[0] }}-800.jpg",{%- endif -%}
          "url": "{{ canonical_url }}#{{ producto.modelo }}",
          "brand": {
            "@type": "Thing",
            "name": "{{ producto.marca }}"
          }
        }
      },
    {%- endfor -%}
  {%- endfor -%}
    ]
  }{%- endcapture -%}
  {{ jsonld | strip_newlines | replace:',]',']' }}
{%- endif -%}
